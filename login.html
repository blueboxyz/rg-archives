<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>RG ARCHIVES – Access Terminal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Tactical monospace font -->
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #050203;
      --panel: #0a0506;
      --accent: #ff4b4b;
      --accent-soft: #ff4b4b44;
      --danger: #ff3b3b;
      --warn: #ffb84d;
      --text-main: #ffe5e5;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      min-height: 100vh;
      background:
        radial-gradient(circle at top, #2a0a0a 0, #050203 50%),
        #050203;
      color: var(--text-main);
      font-family: "Share Tech Mono", monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 16px;
      overflow: hidden;
    }

    /* GRID BACKGROUND */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255, 0, 0, 0.05) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 0, 0, 0.05) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      opacity: 0.35;
      z-index: -1;
    }

    /* SPLASH SCREEN */
    #splash {
      position: fixed;
      inset: 0;
      background: #050203;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999;
      animation: splashFadeOut 5.2s forwards;
      overflow: hidden;
    }

    /* Distortion ripple overlay */
    #ripple {
      position: absolute;
      width: 600px;
      height: 600px;
      background: radial-gradient(circle, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 60%);
      border-radius: 50%;
      opacity: 0;
      transform: scale(0.2);
      pointer-events: none;
      mix-blend-mode: overlay;
    }

    @keyframes rippleEffect {
      0% {
        opacity: 0.35;
        transform: scale(0.2);
        filter: blur(0px);
      }
      100% {
        opacity: 0;
        transform: scale(3.5);
        filter: blur(8px);
      }
    }

    @keyframes splashFadeOut {
      0% { opacity: 1; transform: scale(1); }
      75% { opacity: 1; transform: scale(1); }
      85% { opacity: .55; transform: scale(.97); filter: blur(1px); }
      100% { opacity: 0; transform: scale(.94); filter: blur(4px); visibility: hidden; }
    }

    .splash-content {
      text-align: center;
      color: #ff4b4b;
      animation: popIn 0.8s ease-out;
    }

    @keyframes popIn {
      0% { transform: scale(0.7); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .splash-title {
      font-size: 36px;
      letter-spacing: 0.28em;
      margin-bottom: 12px;
      text-shadow: 0 0 15px rgba(255, 50, 50, 0.8);
    }

    .splash-sub {
      font-size: 14px;
      color: #ffb3b3;
      margin-bottom: 18px;
      letter-spacing: 0.15em;
    }

    .loader {
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255,75,75,0.25);
      border-top: 3px solid #ff4b4b;
      border-radius: 50%;
      margin: 0 auto;
      animation: spin 1.1s linear infinite;
    }

    @keyframes spin { 0%{transform:rotate(0);}100%{transform:rotate(360deg);} }

    /* CONSOLE */
    .console {
      width: 100%;
      max-width: 480px;
      background: linear-gradient(135deg, #12080a, #0a0506);
      border-radius: 12px;
      border: 1px solid rgba(255, 75, 75, 0.35);
      padding: 18px 20px;
      opacity: 0;
      transform: translateY(16px);
      animation: consoleFadeIn 1.8s ease-out forwards;
      animation-delay: 4.0s;
    }

    @keyframes consoleFadeIn {
      0% { opacity: 0; transform: translateY(16px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    /* SCANLINES */
    .console::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom,
        rgba(0,0,0,0) 0%,
        rgba(255,255,255,0.07) 50%,
        rgba(0,0,0,0) 100%);
      background-size: 100% 3px;
      mix-blend-mode: overlay;
      opacity: 0.25;
      pointer-events: none;
      animation: scan 3s linear infinite;
    }

    @keyframes scan { 0%{transform:translateY(0);}100%{transform:translateY(3px);} }

    /* HEADER */
    .console-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .console-title {
      font-size: 14px;
      letter-spacing: 0.18em;
      color: var(--accent);
      text-transform: uppercase;
    }

    .status-pill {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--accent-soft);
      background: rgba(255,75,75,0.05);
      color: var(--accent);
    }

    .divider {
      border-top: 1px solid rgba(255,75,75,0.3);
      margin: 6px 0 10px;
    }

    .console-subtitle {
      font-size: 13px;
      color: #ff9f9f;
      margin-bottom: 10px;
    }

    /* INPUT */
    .field-label {
      font-size: 12px;
      color: #e39c9c;
      margin-bottom: 4px;
    }

    .key-row {
      display: flex;
      gap: 6px;
    }

    input {
      flex: 1;
      padding: 10px;
      background: rgba(30, 10, 10, 0.9);
      border: 1px solid rgba(255,75,75,0.25);
      border-radius: 6px;
      color: var(--text-main);
      outline: none;
    }

    input:focus {
      background: rgba(40, 15, 15, 0.95);
      border-color: var(--accent);
      box-shadow: 0 0 10px rgba(255,75,75,0.3);
    }

    button {
      padding: 10px 14px;
      border-radius: 6px;
      border: 1px solid var(--accent);
      background: #200708;
      letter-spacing: 0.12em;
      color: var(--accent);
      cursor: pointer;
      transition: 0.15s;
    }

    button:hover { box-shadow: 0 0 10px rgba(255,75,75,0.4); transform: translateY(-1px); }

    /* TERMINAL */
    .terminal {
      margin-top: 12px;
      background: #0b0405;
      border-radius: 8px;
      border: 1px solid rgba(255,75,75,0.3);
      height: 130px;
      padding: 8px;
      overflow-y: auto;
      font-size: 11px;
    }

    .terminal-line { margin: 2px 0; }
    .terminal-line-prefix { color: var(--accent); margin-right: 4px; }
    .terminal-line-error { color: var(--danger); }
    .terminal-line-success { color: var(--accent); }

    /* FOOTER */
    .rg-footer {
      margin-top: 14px;
      text-align: center;
      font-size: 11px;
      letter-spacing: 0.22em;
      text-shadow:
        0 0 6px rgba(255,70,70,0.7),
        0 0 16px rgba(255,40,40,0.35);
      animation: footerPulse 2.8s infinite ease-in-out;
      color: #ff4b4b;
    }

    @keyframes footerPulse { 0%{opacity:.6;}50%{opacity:1;}100%{opacity:.6;} }

  </style>
</head>

<body>

<!-- SPLASH SCREEN -->
<div id="splash">
  <div id="ripple"></div>
  <div class="splash-content">
    <div class="splash-title">RG ARCHIVES</div>
    <div class="splash-sub">SECURITY NODE INITIALIZING...</div>
    <div class="loader"></div>
  </div>
</div>

<!-- AUDIO FOR BEEP / STATIC -->
<audio id="bootSound">
  <source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
</audio>

<!-- MAIN CONSOLE -->
<div class="console">
  <div class="console-header">
    <div class="console-title">RG ARCHIVES // ACCESS NODE #01</div>
    <div class="status-pill">STATUS: ACTIVE</div>
  </div>

  <div class="divider"></div>
  <div class="console-subtitle">RESTRICTED ACCESS TERMINAL — AUTH REQUIRED</div>

  <div class="field-label">Input Key:</div>

  <div class="key-row">
    <input id="keyInput" placeholder="Enter license key..." onkeydown="if(event.key==='Enter') login();" />
    <button id="loginButton" onclick="login()">AUTH</button>
  </div>

  <div class="terminal" id="terminal"></div>
  <p id="message"></p>

  <div class="rg-footer">RG ARCHIVES // SECURE DATABASE NETWORK</div>
</div>


<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
  const AUDIO_ENABLED = true;

  const beep = document.getElementById("bootSound");

  setTimeout(() => {
    if (AUDIO_ENABLED) beep.play();
  }, 600);

  const ripple = document.getElementById("ripple");
  setTimeout(() => {
    ripple.style.animation = "rippleEffect 1.4s forwards";
  }, 3400);

  const supabase = window.supabase.createClient(
    "https://ujetrtpzftebyxxlwubj.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVqZXRydHB6ZnRlYnl4eGx3dWJqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ5NTg0MjUsImV4cCI6MjA4MDUzNDQyNX0.aERqN4rFUkyza4hVvua4Cgtpw8Idjg2AVtN0VUz6yZk"
  );

  if (!localStorage.device_id) localStorage.device_id = crypto.randomUUID();
  const device_id = localStorage.device_id;

  const term = document.getElementById("terminal");

  function log(msg, type="info") {
    const div = document.createElement("div");
    div.classList.add("terminal-line");
    if (type === "error") div.classList.add("terminal-line-error");
    if (type === "success") div.classList.add("terminal-line-success");
    div.innerHTML = `<span class='terminal-line-prefix'>>></span>${msg}`;
    term.appendChild(div);
    term.scrollTop = term.scrollHeight;
  }

  const bootMsgs = [
    "Initializing RG ARCHIVES kernel modules...",
    "AUTH SERVER: rg-arc.sec — Establishing link...",
    "AUTH SERVER: rg-arc.sec — LINK STABLE",
    "Running system integrity checks...",
    "Decrypting secure modules...",
    "BOOT SEQUENCE COMPLETE."
  ];

  let i = 0;
  (function boot() {
    if(i < bootMsgs.length) {
      log(bootMsgs[i]);
      i++;
      setTimeout(boot, 450);
    }
  })();


async function login() {
    const key = document.getElementById("keyInput").value.trim();
    const msg = document.getElementById("message");
    const btn = document.getElementById("loginButton");

    if (!key) {
        msg.textContent = "NO KEY ENTERED";
        msg.style.color = "var(--danger)";
        log("Rejected: no key provided.", "error");
        return;
    }

    msg.textContent = "PROCESSING...";
    msg.style.color = "#ffb5b5";
    log(`Checking key: ${key.slice(0, 8)}...`);

    btn.disabled = true;

    const { data, error } = await supabase.rpc("validate_license_key", {
        input_key: key,
        device_id
    });

    btn.disabled = false;

    if (error) {
        msg.textContent = "SERVER ERROR";
        msg.style.color = "var(--danger)";
        log("RPC error occurred.", "error");
        return;
    }

    // Normalize status format — handles both object, array, and direct string
    const status =
        data?.status ||
        data?.result?.status ||
        data?.[0]?.status ||
        data;

    console.log("RPC STATUS:", status);

    // ---- VALID ----
    if (status === "valid") {
        msg.textContent = "ACCESS GRANTED";
        msg.style.color = "var(--accent)";
        log("Authorization successful.", "success");

        localStorage.setItem("rg_session", JSON.stringify({
            active: true,
            key: key,
            device: device_id,
            timestamp: Date.now()
        }));

        setTimeout(() => {
            window.location.href = "dashboard.html";
        }, 800);

        return; // <-- stops here
    }

    // ---- INVALID ----
    if (status === "invalid") {
        msg.textContent = "INVALID KEY";
        msg.style.color = "var(--danger)";
        log("Invalid key attempt.", "error");
        return;
    }

    // ---- BLACKLISTED ----
    if (status === "blacklisted") {
        msg.textContent = "KEY BLACKLISTED";
        msg.style.color = "var(--warn)";
        log("Blacklisted key detected!", "error");
        return;
    }

    // ---- ANYTHING ELSE ----
    msg.textContent = "UNKNOWN RESPONSE";
    msg.style.color = "var(--warn)";
    log("Unexpected server status.", "error");
}

</script>

</body>
</html>
